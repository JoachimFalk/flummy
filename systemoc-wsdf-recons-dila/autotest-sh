# -will be processed by BASH, shebang is inserted by make-

#
# simple autotest for the SQR example. We just start the binary with parameter
# and check the output. Some confusing debug output is send to nirvana.
#
# autovars like $srcdir are inserted by make.
#

#
golden_logs_dir=$srcdir/ref_data

logoutfile=autotest.log

#
test_bin_table="$builddir/simulation-wsdf-recons-dila $builddir/simulation-wsdf-recons-dila-fast $builddir/simulation-wsdf-recons-dila-fifo"

for test_bin in $test_bin_table
do
	# call binary
	$test_bin example.bmp seed.bmp out.bmp > $logoutfile 2> /dev/null

	# make sure 'golden' logfile exist! i leave checks for clarity
	diff out1.bmp $golden_logs_dir/result_example.bmp > /dev/null

	if [ $? -gt 0 ]; then
  	echo $test_bin "result differs."
	  test_failed=1
	fi
done

# remove test logfile
rm -f $logoutfile

[[ -z "$test_failed" ]]
